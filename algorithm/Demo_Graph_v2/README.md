

### 1. 项目概述

CS2201-RAG是一个基于neo4j图数据库(或其它图数据库)的知识图谱检索式问答系统，能够根据自然语言、语音多种形式的提问，从知识图谱(数据库)中获取相关实体信息，并通过知识图谱检索技术以及结合大模型自身能力来增强回答用户提问。

### 2. 核心文件及其功能

1. KGB_RAG.py - 主控制类

- 负责协调整个问答流程

- 管理各个模块的交互

- 提供对话历史管理功能

- 支持流式输出

​	2.module.py - 核心功能模块

- QueryRewriter: 问题改写器，优化用户输入

- CypherGenerator: Cypher查询语句生成器

- CypherQuerier: 图数据库查询执行器

- Formatter: 查询结果格式化器

- AnswerGenerator: 最终答案生成器

​	3.prompt.py - 提示模板

- 定义各种提示模板

- 包含图数据库模式定义

- 定义查询生成规则

- 定义答案生成规则

​	4.graph_database.py - 图数据库接口

- 管理与Neo4j数据库的连接

- 执行Cypher查询

- 处理查询结果

​	5.web_ui.py 和 web_ui_func.py - Web界面

- 提供用户交互界面

- 处理用户输入

- 展示查询结果

​	6.api.py

- 提供大语言模型切换功能，（目前仅实现了openai到通义千问的转换）

  

### 3. 工作流程

输入问题(多种模态输入)->改写问题->生成查询语句->查询图谱->格式化数据->将问题与查询信息结合发给大模型->大模型结合材料和自身能力生成答案->输出答案

- **改写问题部分(Query Rewriter)**:该部分会利用大模型对于上下文历史和自身的能力把问题详细化，使得问题更加准确。

- **生成查询语句部分(Cypher Generator)**:该部分大模型会根据改写过后的问题以及给定的模式，生成查询语句。

- **查询图谱部分(Cypher Querier)**:该部分不利用大模型，直接利用图数据库的查询能力，查询出与问题相关的实体和关系。

- **格式化数据部分(Fomatter)**:该部分会将图数据库查询出的数据格式化，使得大模型能够更好理解图谱信息。

- **生成答案部分(Answer Generator)**:该部分会将问题与查询信息结合发给大模型，大模型结合材料以及上下文历史信息和自身能力生成答案。

### 4. 特色功能

1. 多模型支持

- 支持不同的LLM模型（如Tongyi、OpenAI等）

- 可以动态切换模型

1. 流式输出

- 支持同步和异步流式输出

- 提供更好的用户体验

1. 对话历史管理

- 维护对话上下文

- 支持历史记录刷新

- 可配置历史记录长度

1. 灵活的查询生成

- 支持多种查询模式

- 可以生成多个相关查询

- 结果限制可配置

### 5. 配置和依赖

- 使用Neo4j作为图数据库

- 支持多种LLM模型

- 提供Web界面

- 包含完整的错误处理机制

这个项目是一个完整的知识图谱问答系统，通过结合图数据库和大语言模型，实现了智能问答功能。它的模块化设计使得系统易于维护和扩展，同时提供了灵活的配置选项和良好的用户体验。

### 6.配置过程

下载相关环境

创建虚拟环境

`python -m venv myenv`

激活虚拟环境

`myenv\Scripts\activate`

在虚拟环境中安装`pip install -r requirements.txt`和安装`pip install neo4j`

修改neo4j_config.py里面的连接

修改openai_config.py、tongyi_config.py、zhipu_config.py里面的api

进行该项目目录，允许该项目ui

`streamlit run web_ui.py`

即可在页面提问，终端能看见生成的cypher语句和查找结果，页面展示ai回答结果

